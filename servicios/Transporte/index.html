<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Candelaria 2025 | Servicios Oficiales - Transporte</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Leaflet CSS (Mapa) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Open+Sans:wght@400;600&display=swap"
        rel="stylesheet">

    <!-- Configuración de Tailwind y Estilos Personalizados -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        candelaria: {
                            purple: '#4c1d95', // Color principal festivo
                            gold: '#fbbf24',   // Detalles premium
                            lake: '#0ea5e9',   // Lago Titicaca
                            light: '#f5f3ff'   // Fondos suaves
                        }
                    },
                    fontFamily: {
                        sans: ['Open Sans', 'sans-serif'],
                        heading: ['Montserrat', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Open Sans', sans-serif;
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-family: 'Montserrat', sans-serif;
        }

        /* Animaciones suaves */
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Scrollbar personalizado */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Estilos del Mapa */
        .custom-popup .leaflet-popup-content-wrapper {
            border-radius: 0.75rem;
            padding: 0;
            overflow: hidden;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .custom-popup .leaflet-popup-content {
            margin: 0;
            width: 260px !important;
        }

        /* ========== EN TIEMPO REAL Button Styles ========== */
        .btn-live {
            position: relative;
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            color: white;
            padding: 10px 24px;
            border-radius: 30px;
            font-weight: 700;
            font-size: 0.9rem;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.4);
            overflow: hidden;
            animation: pulseLive 2s infinite;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-live::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.25), transparent);
            transition: left 0.6s;
        }

        .btn-live:hover::before {
            left: 100%;
        }

        .btn-live:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 25px rgba(220, 38, 38, 0.6);
        }

        .live-dot {
            width: 10px;
            height: 10px;
            background: white;
            border-radius: 50%;
            animation: blink 1s infinite;
        }

        @keyframes blink {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.3;
            }
        }

        @keyframes pulseLive {

            0%,
            100% {
                box-shadow: 0 4px 15px rgba(220, 38, 38, 0.4);
            }

            50% {
                box-shadow: 0 4px 25px rgba(220, 38, 38, 0.7), 0 0 30px rgba(220, 38, 38, 0.4);
            }
        }

        /* ========== Navigation Link Styles ========== */
        .nav-link-custom {
            color: #e9d5ff;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 8px 16px;
            position: relative;
            transition: color 0.3s ease;
        }

        .nav-link-custom:hover {
            color: #fbbf24;
        }

        .nav-link-custom::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 2px;
            background: #fbbf24;
            transition: width 0.3s ease;
        }

        .nav-link-custom:hover::after {
            width: 80%;
        }

        .nav-link-custom.active {
            color: #fbbf24;
        }

        .nav-link-custom.active::after {
            width: 80%;
        }
    </style>
</head>

<body class="bg-gray-50 text-gray-800">

    <!-- Notificaciones Toast Container -->
    <div id="toast-container" class="fixed bottom-5 right-5 z-50 flex flex-col gap-2"></div>

    <!-- Modal de Detalles (Oculto por defecto) -->
    <div id="detail-modal" class="fixed inset-0 z-50 hidden" aria-labelledby="modal-title" role="dialog"
        aria-modal="true">
        <div class="fixed inset-0 bg-gray-900 bg-opacity-75 transition-opacity backdrop-blur-sm" onclick="closeModal()">
        </div>
        <div class="fixed inset-0 z-10 overflow-y-auto">
            <div class="flex min-h-full items-center justify-center p-4 text-center sm:p-0">
                <div
                    class="relative transform overflow-hidden rounded-2xl bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-2xl fade-in">
                    <!-- Contenido dinámico del modal se inyecta aquí -->
                    <div id="modal-content"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Header Section - Standardized with EN TIEMPO REAL Style -->
    <header class="bg-candelaria-purple text-white shadow-lg sticky top-0 z-40">
        <div class="bg-purple-950 text-xs py-1 text-center text-purple-200">
            Festividad de la Virgen de la Candelaria 2025 - Del 2 al 11 de Febrero
        </div>
        <div class="w-full px-6 md:px-12 py-5">
            <div class="flex justify-between items-center">
                <a href="../../index.php" class="flex items-center cursor-pointer group">
                    <img src="../../principal/virgencandelariaa.png" alt="Candelaria"
                        class="h-10 md:h-12 w-auto object-contain transition-transform duration-300 group-hover:scale-105">
                </a>
                <div class="flex items-center gap-6">
                    <nav class="hidden md:flex items-center gap-2">
                        <a href="../index.php" class="nav-link-custom active">Servicios</a>
                        <a href="../../cultura/cultura.html" class="nav-link-custom">Cultura</a>
                        <a href="../../horarios_y_danzas/index.php" class="nav-link-custom">Horarios</a>
                    </nav>
                    <a href="../../horarios_y_danzas/index.php" class="btn-live">
                        <div class="live-dot"></div>
                        <span>EN TIEMPO REAL</span>
                    </a>
                    <button class="md:hidden text-white" id="mobile-menu-btn">
                        <i data-lucide="menu" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>
        </div>
        <!-- Mobile Menu (Hidden by default) -->
        <div id="mobile-menu"
            class="hidden md:hidden bg-candelaria-purple absolute top-full left-0 w-full shadow-lg border-t border-purple-800 z-30 transition-all duration-300">
            <nav class="flex flex-col p-6 space-y-4">
                <a href="../index.php"
                    class="block text-white text-lg hover:text-candelaria-gold font-semibold border-b border-purple-800 pb-2">Servicios</a>
                <a href="../../cultura/cultura.html"
                    class="block text-white text-lg hover:text-candelaria-gold font-semibold border-b border-purple-800 pb-2">Cultura</a>
                <a href="../../horarios_y_danzas/index.php"
                    class="block text-white text-lg hover:text-candelaria-gold font-semibold border-b border-purple-800 pb-2">Horarios
                    y Danzas</a>
            </nav>
        </div>
    </header>

    <!-- Search & Filters Bar -->
    <div class="bg-white border-b border-gray-200 shadow-sm sticky top-[84px] z-30">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <!-- Inputs Principales -->
            <div class="flex flex-col md:flex-row gap-3">

                <!-- Buscador -->
                <div class="relative flex-grow group">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i data-lucide="search"
                            class="w-5 h-5 text-gray-400 group-focus-within:text-candelaria-purple transition-colors"></i>
                    </div>
                    <input type="text" id="search-input"
                        class="block w-full pl-10 pr-3 py-2.5 border border-gray-300 rounded-lg leading-5 bg-gray-50 placeholder-gray-500 focus:outline-none focus:bg-white focus:ring-2 focus:ring-candelaria-purple focus:border-candelaria-purple sm:text-sm transition-all shadow-sm"
                        placeholder="Buscar servicios de transporte...">
                </div>

                <!-- Fechas -->
                <div class="flex gap-2 md:w-auto w-full">
                    <div class="relative flex-1 md:w-40">
                        <input type="date" id="date-start" value="2025-02-02"
                            class="block w-full px-3 py-2.5 border border-gray-300 rounded-lg bg-white text-gray-700 focus:outline-none focus:ring-2 focus:ring-candelaria-purple shadow-sm text-sm font-medium">
                    </div>
                    <div class="relative flex-1 md:w-40">
                        <input type="date" id="date-end" value="2025-02-11"
                            class="block w-full px-3 py-2.5 border border-gray-300 rounded-lg bg-white text-gray-700 focus:outline-none focus:ring-2 focus:ring-candelaria-purple shadow-sm text-sm font-medium">
                    </div>
                </div>

                <!-- Huéspedes -->
                <div class="relative md:w-40 w-full">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i data-lucide="users" class="w-4 h-4 text-gray-500"></i>
                    </div>
                    <select id="guest-count"
                        class="block w-full pl-10 pr-8 py-2.5 border border-gray-300 rounded-lg bg-white text-gray-700 focus:outline-none focus:ring-2 focus:ring-candelaria-purple shadow-sm text-sm appearance-none cursor-pointer hover:bg-gray-50">
                        <option value="1">1 Persona</option>
                        <option value="2" selected>2 Personas</option>
                        <option value="3">3 Personas</option>
                        <option value="4+">4+ Grupo</option>
                    </select>
                    <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                        <i data-lucide="chevron-down" class="w-4 h-4 text-gray-400"></i>
                    </div>
                </div>
            </div>

            <!-- Filtros Chips -->
            <div class="flex flex-wrap gap-2 mt-4" id="filter-container">
                <!-- Se llenan vía JS -->
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">

        <!-- Navigation Tabs -->
        <nav class="flex space-x-1 border-b border-gray-200 mb-6 overflow-x-auto pb-1 scrollbar-hide" aria-label="Tabs">
            <button onclick="setActiveTab('hospedajes')" id="tab-hospedajes"
                class="tab-btn whitespace-nowrap py-3 px-6 border-b-2 font-medium text-sm flex items-center gap-2 border-transparent text-gray-500 hover:border-candelaria-purple hover:text-candelaria-purple transition-colors">
                <i data-lucide="bed-double" class="w-4 h-4"></i> Hospedajes
            </button>
            <button onclick="setActiveTab('restaurantes')" id="tab-restaurantes"
                class="tab-btn whitespace-nowrap py-3 px-6 border-b-2 font-medium text-sm flex items-center gap-2 border-transparent text-gray-500 hover:border-candelaria-purple hover:text-candelaria-purple transition-colors">
                <i data-lucide="utensils" class="w-4 h-4"></i> Gastronomía
            </button>
            <button onclick="setActiveTab('transporte')" id="tab-transporte"
                class="tab-btn whitespace-nowrap py-3 px-6 border-b-2 font-medium text-sm flex items-center gap-2 border-candelaria-purple text-candelaria-purple text-gray-900">
                <i data-lucide="car" class="w-4 h-4"></i> Transporte
            </button>
            <button onclick="setActiveTab('info')" id="tab-info"
                class="tab-btn whitespace-nowrap py-3 px-6 border-b-2 font-medium text-sm flex items-center gap-2 border-transparent text-gray-500 hover:border-candelaria-purple hover:text-candelaria-purple transition-colors">
                <i data-lucide="info" class="w-4 h-4"></i> Turismo
            </button>
        </nav>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 items-start">

            <!-- Left Column: List of Cards -->
            <div class="lg:col-span-2">
                <div class="flex justify-between items-end mb-4">
                    <h2 class="text-lg font-bold text-gray-800" id="results-count">Mostrando resultados de Transporte
                    </h2>
                    <span class="text-xs text-gray-500">Precios actualizados para Feb 2025</span>
                </div>

                <!-- Container de Tarjetas -->
                <div id="cards-container" class="space-y-6 min-h-[500px]">
                    <!-- JS Inyectará las tarjetas aquí -->
                    <div class="animate-pulse flex space-x-4">
                        <div class="flex-1 space-y-4 py-1">
                            <div class="h-4 bg-gray-200 rounded w-3/4"></div>
                            <div class="space-y-2">
                                <div class="h-4 bg-gray-200 rounded"></div>
                                <div class="h-4 bg-gray-200 rounded w-5/6"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-8 text-center hidden" id="load-more-btn">
                    <button
                        class="px-6 py-3 border border-gray-300 rounded-full text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors shadow-sm">
                        Cargar más resultados
                    </button>
                </div>
            </div>

            <!-- Right Column: Interactive Map -->
            <div class="lg:col-span-1 hidden lg:block">
                <div
                    class="sticky top-40 bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden h-[650px] flex flex-col">
                    <div class="p-4 bg-white border-b border-gray-100 z-10 flex justify-between items-center shadow-sm">
                        <h3 class="font-bold text-gray-800 flex items-center">
                            <i data-lucide="map-pin" class="w-5 h-5 mr-2 text-candelaria-purple"></i>
                            Mapa Interactivo
                        </h3>
                        <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full font-medium">En
                            vivo</span>
                    </div>
                    <!-- Contenedor Leaflet -->
                    <div id="map-container" class="flex-1 w-full h-full z-0 bg-gray-100 relative"></div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white mt-16 border-t-4 border-candelaria-gold">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div class="col-span-1 md:col-span-2">
                    <div class="flex items-center gap-2 mb-4">
                        <i data-lucide="sparkles" class="w-6 h-6 text-candelaria-gold"></i>
                        <span class="text-xl font-bold font-heading">Candelaria 2025</span>
                    </div>
                    <p class="text-gray-400 text-sm mb-6 max-w-md">
                        Plataforma oficial de servicios turísticos para la Festividad de la Virgen de la Candelaria en
                        Puno, Patrimonio Cultural Inmaterial de la Humanidad (UNESCO).
                    </p>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-400 hover:text-white"><i data-lucide="facebook"
                                class="w-5 h-5"></i></a>
                        <a href="#" class="text-gray-400 hover:text-white"><i data-lucide="twitter"
                                class="w-5 h-5"></i></a>
                        <a href="#" class="text-gray-400 hover:text-white"><i data-lucide="instagram"
                                class="w-5 h-5"></i></a>
                    </div>
                </div>

                <div>
                    <h4 class="text-lg font-bold mb-4 text-white">Enlaces Rápidos</h4>
                    <ul class="space-y-2 text-sm text-gray-400">
                        <li><a href="../../horarios_y_danzas/index.php"
                                class="hover:text-candelaria-gold transition-colors">Programación Oficial</a>
                        </li>
                        <li><a href="#" class="hover:text-candelaria-gold transition-colors">Rutas de Desfile</a></li>
                        <li><a href="#" class="hover:text-candelaria-gold transition-colors">Números de Emergencia</a>
                        </li>
                        <li><a href="#" class="hover:text-candelaria-gold transition-colors">Historia de la
                                Festividad</a></li>
                    </ul>
                </div>

                <div>
                    <h4 class="text-lg font-bold mb-4 text-white">Contacto</h4>
                    <ul class="space-y-2 text-sm text-gray-400">
                        <li class="flex items-center gap-2"><i data-lucide="phone" class="w-4 h-4"></i> +51 951 123 456
                        </li>
                        <li class="flex items-center gap-2"><i data-lucide="mail" class="w-4 h-4"></i>
                            info@candelaria2025.pe</li>
                        <li class="flex items-center gap-2"><i data-lucide="map-pin" class="w-4 h-4"></i> Plaza de
                            Armas, Puno</li>
                    </ul>
                </div>
            </div>
            <div class="border-t border-gray-800 mt-12 pt-8 text-center text-sm text-gray-500">
                &copy; 2025 Gobierno Regional de Puno & Comité de Salvaguardia. Todos los derechos reservados.
            </div>
        </div>
    </footer>

    <!-- Scripts: Libraries first (already in head), then Logic -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // ==========================================
        // 1. BASE DE DATOS (DATA)
        // ==========================================
        // Coordenadas base Puno: -15.8402, -70.0219

        const DB = {
            hospedajes: [],
            restaurantes: [],
            transporte: [], // Se llenará desde la API
            info: []
        };

        // ==========================================
        // 2. FUNCIONES DE UTILIDAD
        // ==========================================

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `p-4 rounded-lg shadow-lg flex items-center space-x-3 transition-all duration-300 ${type === 'error' ? 'bg-red-500 text-white' : type === 'success' ? 'bg-green-500 text-white' : 'bg-blue-500 text-white'}`;
            toast.innerHTML = `
                <i data-lucide="${type === 'error' ? 'alert-circle' : type === 'success' ? 'check-circle' : 'info'}" class="w-5 h-5"></i>
                <span>${message}</span>
            `;
            document.getElementById('toast-container').appendChild(toast);
            lucide.createIcons();

            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 5000);
        }

        function setActiveTab(tabName) {
            // Check current page and only redirect if different
            const currentPath = window.location.pathname;

            switch (tabName) {
                case 'hospedajes':
                    if (!currentPath.includes('/Hospedajes/')) {
                        window.location.href = '/servicios/Hospedajes/';
                    }
                    break;
                case 'restaurantes':
                    if (!currentPath.includes('/Gastronomia/')) {
                        window.location.href = '/servicios/Gastronomia/';
                    }
                    break;
                case 'transporte':
                    if (!currentPath.includes('/Transporte/')) {
                        window.location.href = '/servicios/Transporte/';
                    }
                    break;
                case 'info':
                    if (!currentPath.includes('/Turismo/')) {
                        window.location.href = '/servicios/Turismo/';
                    }
                    break;
                default:
                    window.location.href = '/servicios/Transporte/';
                    break;
            }
        }

        function closeModal() {
            document.getElementById('detail-modal').classList.add('hidden');
        }

        // ==========================================
        // 3. FUNCIONES DE MAPA
        // ==========================================

        let map;
        let markers = [];

        function initMap() {
            if (!map) {
                map = L.map('map-container').setView([-15.8402, -70.0219], 14);

                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                }).addTo(map);
            }
            clearMap();
        }

        function clearMap() {
            markers.forEach(marker => map.removeLayer(marker));
            markers = [];
        }

        function addMarkerToMap(lat, lng, title, description, id, type) {
            if (!map) initMap();

            const customIcon = L.divIcon({
                className: 'custom-marker',
                html: `<div class="bg-candelaria-purple text-white p-2 rounded-full shadow-lg flex items-center justify-center w-8 h-8">
                        <i data-lucide="car" class="w-4 h-4"></i>
                      </div>`,
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            });

            const popupContent = `
                <div class="p-3">
                    <h4 class="font-bold text-gray-800">${title}</h4>
                    <p class="text-sm text-gray-600 mt-1">${description || 'Servicio de transporte en Puno'}</p>
                    <button onclick="openDetailModal(${id})" class="mt-2 text-sm bg-candelaria-purple text-white px-3 py-1 rounded hover:bg-purple-700 transition-colors">
                        Ver detalles
                    </button>
                </div>
            `;

            const marker = L.marker([lat, lng], { icon: customIcon }).addTo(map);
            marker.bindPopup(popupContent);
            marker.on('click', () => openDetailModal(id));
            markers.push(marker);
        }

        // ==========================================
        // 4. FUNCIONES DE API
        // ==========================================

        async function fetchTransporteData() {
            try {
                console.log('Fetching transporte data from API...');
                const response = await fetch('../../api/transporte.php');

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log('Transporte data received:', data);

                // Convert the API data to match our data structure
                return data.map(item => {
                    console.log('DEBUG: Processing transporte item:', item);
                    // Use image from the API if available, otherwise use default
                    const image = (item.imagenes && item.imagenes.length > 0)
                        ? item.imagenes[0]
                        : (item.imagen
                            ? item.imagen
                            : 'https://images.unsplash.com/photo-1449965408869-eaa3f722e40d?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80');

                    console.log('DEBUG: Selected image for transporte:', image);

                    return {
                        id: item.id,
                        name: item.nombre,
                        rating: item.calificacion || 0,
                        reviews: 50, // Default for now
                        priceRange: item.tipo || '$$',
                        location: `${item.ubicacion} a ${item.destino}`,
                        lat: item.latitud ? parseFloat(item.latitud) : (-15.8402 + (Math.random() * 0.02 - 0.01)), // Use actual coordinates if available, otherwise generate random near Puno
                        lng: item.longitud ? parseFloat(item.longitud) : (-70.0219 + (Math.random() * 0.02 - 0.01)),
                        features: item.servicios || ['Servicio confiable'],
                        image: image,
                        description: item.descripcion || `Servicio de transporte tipo ${item.tipo} desde ${item.ubicacion} a ${item.destino}. Capacidad: ${item.capacidad} personas.`,
                        tipo: item.tipo,
                        precio: item.precio,
                        capacidad: item.capacidad,
                        horario_inicio: item.horario_inicio,
                        horario_fin: item.horario_fin
                    };
                });
            } catch (error) {
                console.error('Error fetching transporte data:', error);
                showToast(`Error al cargar datos de transporte: ${error.message}`, 'error');
                return [];
            }
        }

        async function loadData(type) {
            console.log(`Loading data for ${type}`);
            const cardsContainer = document.getElementById('cards-container');
            cardsContainer.innerHTML = `
                <div class="animate-pulse flex space-x-4 p-4">
                    <div class="rounded-full bg-gray-200 h-16 w-16"></div>
                    <div class="flex-1 space-y-4 py-1">
                        <div class="h-4 bg-gray-200 rounded w-3/4"></div>
                        <div class="space-y-2">
                            <div class="h-4 bg-gray-200 rounded"></div>
                            <div class="h-4 bg-gray-200 rounded w-5/6"></div>
                        </div>
                    </div>
                </div>
            `;
            lucide.createIcons();

            if (type === 'transporte') {
                DB.transporte = await fetchTransporteData();
            }

            displayData(type);
        }

        // ==========================================
        // 5. FUNCIONES DE RENDERIZADO
        // ==========================================

        function displayData(type) {
            const data = DB[type];
            const cardsContainer = document.getElementById('cards-container');
            const resultsCount = document.getElementById('results-count');

            resultsCount.textContent = `Mostrando ${data.length} resultados de ${type}`;

            cardsContainer.innerHTML = '';

            if (data.length === 0) {
                cardsContainer.innerHTML = `
                    <div class="text-center py-12 bg-white rounded-xl shadow-sm border border-gray-200">
                        <i data-lucide="car" class="w-12 h-12 text-gray-300 mx-auto mb-4"></i>
                        <h3 class="text-lg font-medium text-gray-900 mb-2">No se encontraron servicios de transporte</h3>
                        <p class="text-gray-500">Intenta con otros filtros o vuelve más tarde</p>
                    </div>
                `;
                lucide.createIcons();
                return;
            }

            data.forEach(item => {
                const card = createCard(item, type);
                cardsContainer.appendChild(card);

                // Add marker to map
                addMarkerToMap(item.lat, item.lng, item.name, item.description, item.id, type);
            });

            lucide.createIcons();
        }

        function createCard(item, type) {
            const card = document.createElement('div');
            card.className = 'bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-md transition-shadow duration-300';
            card.innerHTML = `
                <div class="flex">
                    <div class="w-1/3">
                        <img src="${item.image}" alt="${item.name}" class="w-full h-full object-cover">
                    </div>
                    <div class="w-2/3 p-4">
                        <div class="flex justify-between items-start">
                            <h3 class="text-lg font-bold text-gray-800">${item.name}</h3>
                            <div class="flex items-center bg-candelaria-purple/10 text-candelaria-purple px-2 py-1 rounded-full text-xs font-medium">
                                <i data-lucide="star" class="w-3 h-3 mr-1"></i>
                                ${item.rating.toFixed(1)}
                            </div>
                        </div>
                        
                        <div class="flex items-center text-sm text-gray-500 mt-1">
                            <i data-lucide="map-pin" class="w-4 h-4 mr-1"></i>
                            <span>${item.location}</span>
                        </div>
                        
                        <div class="flex flex-wrap gap-1 mt-2">
                            ${item.features.slice(0, 3).map(feature => `
                                <span class="bg-gray-100 text-gray-700 px-2 py-1 rounded-full text-xs font-medium">
                                    ${feature}
                                </span>
                            `).join('')}
                        </div>
                        
                        <div class="mt-3 flex justify-between items-center">
                            <div>
                                <span class="text-lg font-bold text-candelaria-purple">${item.tipo || 'Transporte'}</span>
                                <span class="text-sm text-gray-500"> • ${item.capacidad} pasajeros</span>
                            </div>
                            
                            <button onclick="openDetailModal(${item.id})" class="bg-candelaria-purple hover:bg-purple-700 text-white px-4 py-2 rounded-full text-sm font-medium transition-colors">
                                Ver detalles
                            </button>
                        </div>
                    </div>
                </div>
            `;
            return card;
        }

        function openDetailModal(id) {
            const transporte = DB.transporte.find(t => t.id === id);
            if (!transporte) return;

            const modalContent = document.getElementById('modal-content');
            modalContent.innerHTML = `
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="flex justify-between items-start">
                        <h3 id="modal-title" class="text-xl font-bold text-gray-800">${transporte.name}</h3>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i data-lucide="x" class="w-6 h-6"></i>
                        </button>
                    </div>
                    
                    <div class="mt-4">
                        <div class="flex items-center mb-4">
                            <div class="flex items-center">
                                <i data-lucide="star" class="w-5 h-5 text-yellow-400 mr-1"></i>
                                <span class="font-medium">${transporte.rating.toFixed(1)}</span>
                                <span class="text-gray-500 ml-1">(${transporte.reviews} reviews)</span>
                            </div>
                            <div class="mx-2 text-gray-300">•</div>
                            <span class="text-gray-600">${transporte.tipo}</span>
                        </div>
                        
                        <div class="aspect-w-16 aspect-h-9 mb-4">
                            <img src="${transporte.image}" alt="${transporte.name}" class="w-full h-64 object-cover rounded-lg">
                        </div>
                        
                        <p class="text-gray-700 mb-4">${transporte.description}</p>
                        
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div>
                                <h4 class="font-bold text-gray-800 mb-2 flex items-center">
                                    <i data-lucide="map-pin" class="w-4 h-4 mr-2 text-candelaria-purple"></i>
                                    Ruta
                                </h4>
                                <p class="text-gray-600">${transporte.location}</p>
                            </div>
                            <div>
                                <h4 class="font-bold text-gray-800 mb-2 flex items-center">
                                    <i data-lucide="users" class="w-4 h-4 mr-2 text-candelaria-purple"></i>
                                    Capacidad
                                </h4>
                                <p class="text-gray-600">${transporte.capacidad} pasajeros</p>
                            </div>
                            <div>
                                <h4 class="font-bold text-gray-800 mb-2 flex items-center">
                                    <i data-lucide="tag" class="w-4 h-4 mr-2 text-candelaria-purple"></i>
                                    Precio
                                </h4>
                                <p class="text-gray-600">S/ ${transporte.precio.toFixed(2)}</p>
                            </div>
                            <div>
                                <h4 class="font-bold text-gray-800 mb-2 flex items-center">
                                    <i data-lucide="clock" class="w-4 h-4 mr-2 text-candelaria-purple"></i>
                                    Horarios
                                </h4>
                                <p class="text-gray-600">${transporte.horario_inicio || 'N/A'} - ${transporte.horario_fin || 'N/A'}</p>
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="font-bold text-gray-800 mb-2">Servicios incluidos:</h4>
                            <div class="flex flex-wrap gap-2">
                                ${transporte.features.map(feature => `
                                    <span class="bg-candelaria-purple/10 text-candelaria-purple px-3 py-1 rounded-full text-sm font-medium">
                                        ${feature}
                                    </span>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-candelaria-purple text-base font-medium text-white hover:bg-purple-700 sm:ml-3 sm:w-auto sm:text-sm">
                        Reservar ahora
                    </button>
                    <button type="button" onclick="closeModal()" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        Cerrar
                    </button>
                </div>
            `;

            document.getElementById('detail-modal').classList.remove('hidden');
            lucide.createIcons();
        }

        // ==========================================
        // 6. EVENT LISTENERS
        // ==========================================

        document.getElementById('search-input').addEventListener('input', function (e) {
            const searchTerm = e.target.value.toLowerCase();

            if (DB.transporte.length === 0) return;

            const filtered = DB.transporte.filter(item => {
                return item.name.toLowerCase().includes(searchTerm) ||
                    item.description.toLowerCase().includes(searchTerm) ||
                    item.location.toLowerCase().includes(searchTerm) ||
                    item.tipo.toLowerCase().includes(searchTerm);
            });

            displayDataWithFilter('transporte', filtered);
        });

        // ==========================================
        // 7. INICIALIZACIÓN
        // ==========================================

        function displayDataWithFilter(type, filteredData) {
            const cardsContainer = document.getElementById('cards-container');
            const resultsCount = document.getElementById('results-count');

            resultsCount.textContent = `Mostrando ${filteredData.length} resultados de ${type}`;

            cardsContainer.innerHTML = '';

            if (filteredData.length === 0) {
                cardsContainer.innerHTML = `
                    <div class="text-center py-12 bg-white rounded-xl shadow-sm border border-gray-200">
                        <i data-lucide="search" class="w-12 h-12 text-gray-300 mx-auto mb-4"></i>
                        <h3 class="text-lg font-medium text-gray-900 mb-2">No se encontraron resultados</h3>
                        <p class="text-gray-500">Intenta con otros términos de búsqueda</p>
                    </div>
                `;
                lucide.createIcons();
                clearMap();
                return;
            }

            filteredData.forEach(item => {
                const card = createCard(item, type);
                cardsContainer.appendChild(card);

                // Add marker to map
                addMarkerToMap(item.lat, item.lng, item.name, item.description, item.id, type);
            });

            lucide.createIcons();
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', async function () {
            console.log('Page loaded, initializing Transporte page...');
            lucide.createIcons();

            // Load transporte data for the current active tab
            await loadData('transporte');
        });
    </script>

    <!-- Chatbot Widget -->
    <link rel="stylesheet" href="../../assets/css/chatbot-widget.css">
    <div id="chatbot-widget"></div>
    <script src="../../assets/js/chatbot-widget.js"></script>

    <script>
        // Mobile Menu Logic
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');

        if (mobileMenuBtn && mobileMenu) {
            mobileMenuBtn.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });
        }
    </script>
</body>

</html>